<?php
$z[0]=Array("php","\r\n\r\nerror_reporting(E_ALL);\r\nini_set('display_errors', '1');\r\n\r\nclass item {\r\n};\r\n\r\n\$result = array();\r\n\r\n\$sql = \"SELECT `id`, `title`, `description`, `litpic`, `isnew`, `isactive` FROM `dede_archives` INNER JOIN `dede_addonactivity` ON `dede_archives`.`id` = `dede_addonactivity`.`aid` WHERE 1 = 1 AND `dede_archives`.`typeid` = 26;\";\r\n\$query = mysql_query(\$sql);\r\nwhile(\$row=mysql_fetch_array(\$query)){\r\n    \$item = new item();\r\n    \$item->title = iconv(\"gb2312\",\"utf-8\", \$row['title']);\r\n    //\$item->desc = iconv(\"gb2312\",\"utf-8\",\$row[\"description\"]);\r\n	\$dec= iconv(\"gb2312\",\"utf-8\",\$row[\"description\"]);\r\n	if(strlen(\$dec)>50)\r\n	{\r\n	 \$item->desc = mb_substr( \$dec, 0, 50, \"utf-8\" ). \" \" .\"……\"; \r\n	}\r\n	else\r\n	{\r\n	 \$item->desc = \$dec;\r\n	}\r\n	\r\n    \$item->img = apache_lookup_uri( \$row[\"litpic\"] )->uri;\r\n    \$item->isnew = iconv(\"gb2312\",\"utf-8\", \$row[\"isnew\"])==\"是\" ? 1 : 0;\r\n	\$item->issoldout = iconv(\"gb2312\",\"utf-8\", \$row[\"isactive\"])==\"是\" ? 1 : 0;\r\n    \$item->id = \$row[\"id\"];\r\n    \$result[] = \$item;\r\n}\r\n\r\necho json_encode(\$result);\r\n\r\nheader('Content-Type: text/json; charset=utf-8');\r\n\r\n",0,1125);

?>